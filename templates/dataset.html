<!DOCTYPE html>

<html>
    <head>
        <title>Prévision de vente - Dataset</title>
        <link rel="shorcut icon" href="../static/icon/p.ico">
        <meta charset="utf-8"/>
          <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="icon" href="data:;base64,iVBORw0KGgo="/>
        <script type="text/javascript" href="../static/js/bootstrap.min.js"></script>
        <script type="text/javascript" href="../static/js/bootstrap.js"></script>
        <script src="../static/js/jquery-3.4.1.min.js" type="text/javascript"></script>
        <script src="../static/js/jquery.min.js" type="text/javascript"></script>
        
        
        <link href="../static/css/bootstrap.min.css" rel="stylesheet">
        <link href="../static/css/all.min.css" rel="stylesheet">
        <link href="../static/css/ensemble.css" rel="stylesheet">
        <link href="../static/css/dashboard.css" rel="stylesheet">
        <link href="../static/css/monstyle.css" rel="stylesheet">
        <link href="../static/css/loginStyle.css" rel="stylesheet">
        <link href="../static/css/w3.css" rel="stylesheet">
        <link href="../static/css/bootstrap.css" rel="stylesheet">
        <link href="../static/css/css/font-awesome.min.css" rel="stylesheet"> 
        <link rel="stylesheet" type="text/css" href="../static/css/style.css"/>
        <link href="../static/css/acc.css" rel="stylesheet" type="text/css"/>
        <link href="../static/css/flexslider.css" rel="stylesheet" type="text/css"/>
        <link href="../static/css/style-dataset.css" rel="stylesheet">
      
        <script type="text/javascript" src="js/xlsx.full.min.js"></script>
        <script src="../static/js/jquery.min.js"></script>
        <script src="../static/js/jquery.min.js"></script>
        <script src="tf/tf.min.js"></script>
        <script src="tf/tf.js"></script>
        <script src="js/Chart.min.js" type="text/javascript"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
        <script src="js/Chart.min.js" type="text/javascript"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
        <!--<script type="text/javascript" src="app.js"></script> -->
    </head>
<body>
<div class="">
         <section class="hero " id="hero" style="margin-top: 155px; margin-bottom: -90px;">
            <div class="container ">
                <nav class="navbar navbar-inverse navdataset ">
                <img src="../static/icon/icone.PNG" style="width:50px;height:50px;">
                  <div class="container-fluid">
                    <ul class="nav navbar-nav">
                      <li><a class="nav-link" href="accueil">Accueil</a></li>
                      <li><a class="nav-link" href="#">Importation des données</a></li>
                      <li class="active"><a class="nav-link" href="#">Paramètres</a></li>
                      <li><a class="nav-link" href="#">Résultat</a></li>
                      <li><a class="nav-link" href="apropos">A propos</a></li>
                      <li><a class="nav-link" href="historique">Historiques</a></li>
                    </ul>

                    <form class="navbar-form navbar-left" action="https://www.google.com">
                      <div class="input-group">
                        <input type="text" class="form-control" placeholder="Rechercher" name="search">
                        <div class="input-group-btn">
                          <button class="btn btn-default" type="submit">
                            <i class="glyphicon glyphicon-search"></i>
                          </button>
                        </div>
                      </div>
                    </form>

                    <a href="accueil"><img src="../static/icon/shut.ico" style="width:35px;height:35px;margin-top:8px;margin-left:80px;"></a>

                  </div>
                </nav>
            </div>
        </section>
            
    </div>

<div>
    
    <div class="container">

            <div class="" style="margin-top: -20px;margin-bottom: 15px;text-align: center">
                <div class="col-xl-2"><h4> Nombre de ligne : {{shape[0]}}</h4></div></br>
                <div class="col-xl-2"><h4> Nombre de colonne : {{shape[1]}}</h4></div>
            </div>

            <div class="row canvas1" style="margin-top: 15px;margin-bottom: 15px;text-align: center">
                <div class="col-xl-8"><h1 class="text-success">Choisissez les paramètres pour faire la prédiction</h1></div>
                
            </div>


        <div class="">
            <form method="post" action="/resultat" enctype=multipart/form-data >
            <div class="row ">
                <div class="col-xl-3 ">
                    <!--<form action="#" method="post">-->
                        <div class="form-group ">
                            <label for="Indexation">Type de données : </label>
                            <select class="form-control" id="Type-donnee" name="VariableIndexation" >
                                <option>Sélectionner</option>
                                <option>Tabulaire</option>
                                <option>Série temporelle</option>
                            </select>
                        </div>
                    <!--</form>-->
                </div>
                <div class="col-xl-3">
                    <!--<form action="#" method="post">-->
                        <div class="form-group">
                            <label for="Entrainement">Type d'entrainement:</label>
                            <select class="form-control" id="Entrainement" name="typeEntrainement">
                                <option>Sélectionner</option>
                                <option>Régression</option>
                                <option>Classification</option>
                            </select>
                        </div>
                    <!--</form>-->
                </div>
                <div class="col-xl-3">
                    <!--<form action="#" method="post">-->
                        <div class="form-group">
                            <label for="Target">Variable d'indexation:</label>
                            <select class="form-control" name="Indexation" id="Index">
                                
                               {% for val in liste_colonne %}
                               <option value= "{{val}}" SELECTED>{{val}}</option>"
                               {% endfor %}
                            </select>
                        </div>
                    <!--</form>-->
                </div>
                 <div class="col-xl-3">
                    <!--<form action="#" method="post">-->
                        <div class="form-group">
                            <label for="Target">Variable cible (target):</label>
                            
                            <select class="form-control" id="target" name="Target">
                                
                               {% for val in liste_colonne %}
                               <option value= "{{val}}" SELECTED>{{val}}</option>"
                               {% endfor %}
                            </select>
                            
                        </div>
                    <!--</form>-->
                </div>

            </div>

                <div class="canvas1 predire">
                <input class="btn btn-info " name='predire' type="submit" onclick="Prediction()" value="Prédire"/></div>
            </form>

        </div>

        </div>
    </div>

    </body>


<script>

var type_donnee=document.getElementById('Type-donnee');
var index=document.getElementById('Indexation');
var target=document.getElementById('Target');
var entrainement=document.getElementById('Entrainement');

type_donnee.addEventListener('change',select_data);
entrainement.addEventListener('change',select_train);
index.addEventListener('change',select_index);
target.addEventListener('change',select_target);

function Prediction(){
    chartData();

    for (var i=0; i<liste_colonne.length;i++){
        if (var_target===liste_colonne[i])
            alert(liste_colonne[i])
    }

    if (type_train==='Régression'){
    console.log('Régression')
    }else if(type_train==='Classification'){
    console.log('Classification')
    }
    if (type_data==='Tabulaire'){
    console.log('Tabulaire')
    }else if (type_data==='Série temporelle'){
    console.log('Série temporelle')
    }
    alert("prediction")

}

function select_data(evt){
    window.type_data=type_donnee.value;
    console.log(type_data);  
}

function select_train(evt){
    window.type_train=entrainement.value;
    console.log(type_train);
}

function select_index(evt){
    window.var_index=index.value;
    console.log(var_index);
}

function select_target(evt){
    window.var_target=target.value;
    console.log(donnee[var_target]);
}

var data=document.getElementById('data-input');
var btn_charger=document.getElementById('btn-charger');


data.addEventListener('change', importer);


function chartData(){
    //await getData(fichier);
    const ctx = document.getElementById('chart-data').getContext('2d');
    const chart = new Chart(ctx, {
    // The type of chart we want to create
    //type:'bar',
    type: 'line',

    // The data for our dataset
    data: {
        labels:x,
        datasets: [{
            label: 'Variation de'+liste_colonne[1],
            backgroundColor: 'rgb(255, 99, 132,0.2)',
            borderColor: 'rgb(255, 99, 1)',
            data: y
        }]
    },
});

}


function getData(data){
    //await chartData();

    const rows=data.split('\n').slice(0);
       window.liste_colonne=rows[0].split(',');

       for (var i=0;i<liste_colonne.length;i++){
            index.options[i+1].innerHTML=liste_colonne[i];
            target.options[i+1].innerHTML=liste_colonne[i];
        }

      window.donnee=fichier.split('\n');
      //const donnee=fichier.split(/\r?\n|\r|,|;/);
      window.valeur=donnee.slice(1);


      window.x=[];
      window.y=[];

      valeur.forEach(row=>{
            const colonne=row.split(',');
            const mouth=colonne[0];
            x.push(mouth);
            const val=colonne[1];
            y.push(val);

       });
}

async function importer(evt) {
  const f = evt.target.files[0];

  if (f) {
    var r = new FileReader();
    r.onload = e => {
      window.fichier=e.target.result;
      getData(fichier);
      //chartData();

    }
    r.readAsBinaryString(f);

  } else {
    console.log("Failed to load file");
  }
}


function sauver_fichier(){
    var btn_sauver=document.getElementById('download');
    btn_sauver.style.display='none'
    document.getElementById("data-input").value = "";
}


$(document).ready(function () {
    $('#load_data').click(function () {
        $.ajax({
            //url: "airline_passengers.csv",
            dataType: "text",
            success: function (data)
            {
                var employee_data = fichier.split(/\r?\n|\r/);
                var table_data = '<table class="table table-bordered table-striped">';
                for (var count = 0; count < employee_data.length; count++)
                {
                    var cell_data = employee_data[count].split(";");
                    table_data += '<tr>';
                    for (var cell_count = 0; cell_count < cell_data.length; cell_count++)
                    {
                        if (count === 0)
                        {
                            table_data += '<th>' + cell_data[cell_count] + '</th>';
                        } else
                        {
                            table_data += '<td>' + cell_data[cell_count] + '</td>';
                        }
                    }
                    table_data += '</tr>';
                }
                table_data += '</table>';
                $('#vente_table').html(table_data);
            }
        });
    });

});

</script>

</html>